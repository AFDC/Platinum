- content_for :title, @league.name
= render :partial => '/pageheader', :locals => {subtitle: 'League Details', breadcrumbs: {'Leagues' => leagues_path, @league.name => nil}}

.row
    .span5
        = render :partial => '/league_summary', :locals => {league: @league}
        - if permitted_to? :manage, @league
            %hr
            %h4 League Comps
            = render partial: 'comps', locals: {league: @league}

    .span7
        .navbar.navbar-inverse
            .navbar-inner
                %ul.nav
                    %li.active=link_to "League", @league
                    - if @league.registration_open? && permitted_to?(:register, @league)
                        - unless @registration
                            %li
                                =link_to "Register", register_league_path(@league)
                        - else
                            %li= link_to "Update your Registration", edit_registration_path(@registration)

                    %li=link_to "Players", registrations_league_path(@league)
                    - if @league.core_type.present?
                        %li=link_to @league.core_type.capitalize.pluralize, league_registration_groups_path(@league)

                %ul.nav.pull-right
                    - if permitted_to? :manage, @league
                        %li.dropdown
                            = link_to "#", class: "dropdown-toggle", "data-toggle" => "dropdown" do
                                Admin
                                %b.caret
                            %ul.dropdown-menu
                                - if permitted_to? :manage, @league
                                    %li
                                        = link_to edit_league_path(@league) do
                                            %i.icon.icon-pencil
                                            Edit
                                - if permitted_to? :create, :teams
                                    %li
                                        =link_to new_league_team_path(@league) do
                                            %i.icon.icon-plus
                                            Create Team
                                - if permitted_to? :manage_roster, @league
                                    %li
                                        = link_to manage_roster_league_path(@league) do
                                            %i.icon.icon-group
                                            Manage Roster


        %h4 Teams
        %table.table.table-striped.table-condensed
            %thead
                %th Rank
                %th Team
                %th Captains
                %th Record
                %th Pt. Diff.
            %tbody
                - @league.teams.each do |t|
                    - if current_user && current_user.teams.include?(t)
                        - row_style = 'background-color: #a7dff1;'
                    - else
                        - row_style = '';
                    %tr{style:  row_style}
                        %td=t.formatted_rank
                        %td=link_to t.name, team_path(t)
                        - if permitted_to? :show, :users
                            %td=raw t.captains.collect { |c| link_to c.name, user_path(c) }.join(', ')
                        - else
                            %td
                                %i.icon.icon-exclamation-sign.hasTooltip{title: 'Please log in to view captains.'}
                        - if t.games_played > 0
                            %td
                                = t.record
                                = "(" + formatted_winning_percentage(t.winning_percentage) + ")"
                            %td= formatted_point_diff(t.point_diff)
                        - else
                            %td{colspan: 2} Not Available
                - if @league.teams.count == 0
                    %tr
                        %td{colspan: 5, style: 'text-align: center;'} This league has no teams yet.

= render :partial => '/game_schedule', :locals => {start_date: Date.today, league_id: @league._id, title: 'Upcoming Games'}
